<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Steady-state torsional vibration in the crankshaft of an internal combustion engine &mdash; openTorsion  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=b3ba4146"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Modal analysis and steady-state forced response calculation example" href="modal_analysis_and_forced_response.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            openTorsion
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../opentorsion.html">API Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">Tutorials</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="modal_analysis_and_forced_response.html">Modal analysis and steady-state forced response calculation example</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Steady-state torsional vibration in the crankshaft of an internal combustion engine</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">openTorsion</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../examples.html">Examples</a></li>
      <li class="breadcrumb-item active">Steady-state torsional vibration in the crankshaft of an internal combustion engine</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebooks/ICE_example.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Steady-state-torsional-vibration-in-the-crankshaft-of-an-internal-combustion-engine">
<h1>Steady-state torsional vibration in the crankshaft of an internal combustion engine<a class="headerlink" href="#Steady-state-torsional-vibration-in-the-crankshaft-of-an-internal-combustion-engine" title="Permalink to this heading"></a></h1>
<p>Calculation of the steady-state torsional vibration in the crankshaft of an internal combustion engine. Torque produced by each cylinder is calculated from the force produced by the pressure from ignition which is scaled according to the rotation speed of the crankshaft. Torsional vibration analysis based on the article “Analysis of torsional vibration in internal combustion engines: Modelling and experimental validation” [1]. The model is based on Fig.4 of the original article.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span>

<span class="kn">import</span> <span class="nn">opentorsion</span>
<span class="kn">from</span> <span class="nn">opentorsion</span> <span class="kn">import</span> <span class="n">Shaft</span><span class="p">,</span> <span class="n">Disk</span><span class="p">,</span> <span class="n">Assembly</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">pressure_curve</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Load digitized pressure curve from csv and pass it to interpolator&#39;&#39;&#39;</span>
    <span class="n">curve</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="s1">&#39;ICE_example_data/pressure_data.csv&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">curve</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">curve</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">peak_pressures</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Load digitized peak pressure from csv and pass it to interpolator&#39;&#39;&#39;</span>
    <span class="n">curve</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="s1">&#39;ICE_example_data/peak_data.csv&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">curve</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">curve</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">scaled_cylinder_pressure</span><span class="p">(</span><span class="n">rpm</span><span class="p">,</span> <span class="n">num_points</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Scales the cylinder pressure curve based on the variation</span>
<span class="sd">    of peak pressure with engine speed.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    rpm: float</span>
<span class="sd">        Rotating speed of the engine in rpm</span>
<span class="sd">    num_points: int</span>
<span class="sd">        Number of points in x-axis</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    angles: np.ndarray</span>
<span class="sd">        Angles for which the cylinder pressures are given</span>
<span class="sd">    scaled_curve: np.ndarray</span>
<span class="sd">        The scaled pressure curve scaled to the given rpm corresponding</span>
<span class="sd">        to the angles. (Pa)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Load the base pressure curve</span>
    <span class="n">angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">720</span><span class="p">,</span> <span class="n">num_points</span><span class="p">)</span>
    <span class="n">base_curve</span> <span class="o">=</span> <span class="n">pressure_curve</span><span class="p">()</span>
    <span class="n">base_curve_sampled</span> <span class="o">=</span> <span class="n">base_curve</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span><span class="o">/</span><span class="mf">15.2</span>
    <span class="c1"># Scale with the peak pressure</span>
    <span class="n">pressures</span> <span class="o">=</span> <span class="n">peak_pressures</span><span class="p">()</span>
    <span class="n">scaling</span> <span class="o">=</span> <span class="n">pressures</span><span class="p">(</span><span class="n">rpm</span><span class="p">)</span>
    <span class="n">scaled_curve</span> <span class="o">=</span> <span class="n">base_curve_sampled</span><span class="o">*</span><span class="n">scaling</span><span class="o">*</span><span class="mf">1e6</span>

    <span class="k">return</span> <span class="n">angles</span><span class="p">,</span> <span class="n">scaled_curve</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calculate_cylinder_torque</span><span class="p">(</span><span class="n">speed_rpm</span><span class="p">,</span> <span class="n">num_points</span><span class="o">=</span><span class="mi">500</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Calculates the torque produced by a single cylinder at given rpm.</span>
<span class="sd">    Torque is based on the tangential force caused by the pressure in the cylinder and the tangential component</span>
<span class="sd">    of the oscillating inertial force from the crankshaft spinning.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    speed_rpm: float</span>
<span class="sd">        Current rotation speed in rpm</span>
<span class="sd">    num_points: float, optional</span>
<span class="sd">        Number of points for the x-axis</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    M_t: ndarray</span>
<span class="sd">        The torque produced by the cylinder</span>
<span class="sd">    alpha: ndarray</span>
<span class="sd">        Angles for which the cylinder torques are given</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">alpha_to_beta</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">l_rod</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">r</span><span class="o">/</span><span class="n">l_rod</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha</span><span class="p">))</span>

    <span class="n">l_rod</span> <span class="o">=</span> <span class="mf">0.207</span>  <span class="c1"># m</span>
    <span class="n">d_piston</span> <span class="o">=</span> <span class="mf">0.105</span>  <span class="c1"># m</span>
    <span class="n">r</span> <span class="o">=</span> <span class="mf">0.137</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># m (piston stroke / 2) crankshaft radius</span>
    <span class="n">m_a</span> <span class="o">=</span> <span class="mf">2.521</span>  <span class="c1"># kg</span>

    <span class="n">alpha_deg</span><span class="p">,</span> <span class="n">p_curve</span> <span class="o">=</span> <span class="n">scaled_cylinder_pressure</span><span class="p">(</span><span class="n">speed_rpm</span><span class="p">,</span> <span class="n">num_points</span><span class="p">)</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha_deg</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">speed_rpm</span><span class="o">/</span><span class="mi">60</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>

    <span class="n">F_g</span> <span class="o">=</span> <span class="n">p_curve</span> <span class="o">*</span> <span class="mf">0.25</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">d_piston</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">alpha_to_beta</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">l_rod</span><span class="p">)</span>
    <span class="n">F_tg</span> <span class="o">=</span> <span class="n">F_g</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha</span> <span class="o">+</span> <span class="n">beta</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>        <span class="c1"># Tangential gas load</span>
    <span class="n">lambda_rl</span> <span class="o">=</span> <span class="n">r</span><span class="o">/</span><span class="n">l_rod</span>
    <span class="n">F_ia</span> <span class="o">=</span> <span class="o">-</span><span class="n">m_a</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
                   <span class="o">+</span> <span class="n">lambda_rl</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">alpha</span><span class="p">)</span>
                   <span class="o">-</span> <span class="n">lambda_rl</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="mi">1</span><span class="o">/</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">alpha</span><span class="p">)</span>
                   <span class="o">+</span> <span class="mi">9</span><span class="o">*</span><span class="n">lambda_rl</span><span class="o">**</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">alpha</span><span class="p">)</span><span class="o">/</span><span class="mi">128</span><span class="p">)</span><span class="o">*</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span> <span class="c1"># Oscillating inertial force</span>
    <span class="n">F_ta</span> <span class="o">=</span> <span class="n">F_ia</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha</span> <span class="o">+</span> <span class="n">beta</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>       <span class="c1"># Tangential inertial force</span>
    <span class="n">F_t</span> <span class="o">=</span> <span class="n">F_tg</span> <span class="o">+</span> <span class="n">F_ta</span>      <span class="c1"># Total tangential force</span>
    <span class="n">M_t</span> <span class="o">=</span> <span class="n">F_t</span> <span class="o">*</span> <span class="n">r</span>

    <span class="k">return</span> <span class="n">M_t</span><span class="p">,</span> <span class="n">alpha</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calculate_dft_components</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">num_harmonics</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Calculates dft components and harmonics (0,0.5,1,...) for the given signal, to be used at stedy-state</span>
<span class="sd">    vibration calculations.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    signal: ndarray</span>
<span class="sd">        Cylinder torque</span>
<span class="sd">    t: ndarray</span>
<span class="sd">        Crankshaft rotation angle</span>
<span class="sd">    num_harmonics: float</span>
<span class="sd">        Number of harmonics considered</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    complex ndarray</span>
<span class="sd">        The first num_harmonics complex components of the Fourier transform</span>
<span class="sd">    complex ndarray</span>
<span class="sd">        The first num_harmonics components of the harmonics</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">dft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfft</span><span class="p">(</span><span class="n">signal</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">signal</span><span class="p">)</span>
    <span class="n">dft</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">*=</span> <span class="mi">2</span>
    <span class="n">omegas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">rfftfreq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">signal</span><span class="p">))</span><span class="o">*</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">dft</span><span class="p">[:</span><span class="n">num_harmonics</span><span class="p">],</span> <span class="n">omegas</span><span class="p">[:</span><span class="n">num_harmonics</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">crankshaft_assembly</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A shaft-line Finite Element Model of a crankshaft based on model presented</span>
<span class="sd">    in https://doi.org/10.1243/14644193JMBD126 Fig.4.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    assembly: openTorsion Assembly class instance</span>
<span class="sd">        The created opentorsion assembly</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">J2</span>  <span class="o">=</span> <span class="mf">0.0170</span>
    <span class="n">J3</span>  <span class="o">=</span> <span class="mf">0.0090</span>
    <span class="n">J4</span>  <span class="o">=</span> <span class="mf">0.0467</span>
    <span class="n">J5</span>  <span class="o">=</span> <span class="mf">0.0327</span>
    <span class="n">J6</span>  <span class="o">=</span> <span class="mf">0.0467</span>
    <span class="n">J7</span>  <span class="o">=</span> <span class="mf">0.0467</span>
    <span class="n">J8</span>  <span class="o">=</span> <span class="mf">0.0327</span>
    <span class="n">J9</span>  <span class="o">=</span> <span class="mf">0.0487</span>
    <span class="n">J10</span> <span class="o">=</span> <span class="mf">2.0750</span>

    <span class="n">k2</span> <span class="o">=</span> <span class="mf">1.106e6</span>
    <span class="n">k3</span> <span class="o">=</span> <span class="mf">1.631e6</span>
    <span class="n">k4</span> <span class="o">=</span> <span class="mf">1.253e6</span>
    <span class="n">k5</span> <span class="o">=</span> <span class="mf">1.253e6</span>
    <span class="n">k6</span> <span class="o">=</span> <span class="mf">1.678e6</span>
    <span class="n">k7</span> <span class="o">=</span> <span class="mf">1.253e6</span>
    <span class="n">k8</span> <span class="o">=</span> <span class="mf">1.253e6</span>
    <span class="n">k9</span> <span class="o">=</span> <span class="mf">1.976e6</span>

    <span class="n">c_a</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># absolute damping</span>
    <span class="n">shafts</span><span class="p">,</span> <span class="n">disks</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">disks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Disk</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">J2</span><span class="p">))</span>
    <span class="n">shafts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Shaft</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k2</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">disks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Disk</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">J3</span><span class="p">))</span>
    <span class="n">shafts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Shaft</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k3</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">disks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Disk</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">J4</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c_a</span><span class="p">))</span> <span class="c1"># cylinder 1</span>
    <span class="n">shafts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Shaft</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k4</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">disks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Disk</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">J5</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c_a</span><span class="p">))</span>
    <span class="n">shafts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Shaft</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k5</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">disks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Disk</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">J6</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c_a</span><span class="p">))</span>
    <span class="n">shafts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Shaft</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k6</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">disks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Disk</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">J7</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c_a</span><span class="p">))</span>
    <span class="n">shafts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Shaft</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k7</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">disks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Disk</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">J8</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c_a</span><span class="p">))</span>
    <span class="n">shafts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Shaft</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k8</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">disks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Disk</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">J9</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c_a</span><span class="p">))</span> <span class="c1">#cylinder 6</span>
    <span class="n">shafts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Shaft</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k9</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">disks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Disk</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">J10</span><span class="p">))</span> <span class="c1"># flywheel</span>
    <span class="n">assembly</span> <span class="o">=</span> <span class="n">Assembly</span><span class="p">(</span><span class="n">shafts</span><span class="p">,</span> <span class="n">disk_elements</span><span class="o">=</span><span class="n">disks</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">assembly</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">relative_damping_C</span><span class="p">(</span><span class="n">assembly</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Updates the damping matrix C of assembly when using frequency dependent relative damping.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    assembly: openTorsion Assembly class instance</span>
<span class="sd">        The assembly of whose damping matrix is to be updated</span>
<span class="sd">    d: float</span>
<span class="sd">        Loss factor property, used to calculate relative damping</span>
<span class="sd">    w: float</span>
<span class="sd">        Angular frequency of the system, used to calculate relative damping</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    C: ndarray</span>
<span class="sd">        The damping matrix assembled with new component specific damping coefficients</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">w</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">c_r</span> <span class="o">=</span> <span class="n">d</span><span class="o">/</span><span class="n">w</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">c_r</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">assembly</span><span class="o">.</span><span class="n">check_dof</span><span class="p">(),</span> <span class="n">assembly</span><span class="o">.</span><span class="n">check_dof</span><span class="p">()))</span>

    <span class="k">if</span> <span class="n">assembly</span><span class="o">.</span><span class="n">shaft_elements</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">assembly</span><span class="o">.</span><span class="n">shaft_elements</span><span class="p">:</span>
            <span class="n">dof</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">element</span><span class="o">.</span><span class="n">nl</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">nr</span><span class="p">])</span>
            <span class="n">C</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">dof</span><span class="p">,</span> <span class="n">dof</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">c_r</span><span class="o">*</span><span class="n">element</span><span class="o">.</span><span class="n">K</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">assembly</span><span class="o">.</span><span class="n">disk_elements</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">assembly</span><span class="o">.</span><span class="n">disk_elements</span><span class="p">:</span>
            <span class="n">C</span><span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">node</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">node</span><span class="p">]</span> <span class="o">+=</span> <span class="n">element</span><span class="o">.</span><span class="n">C</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">assembly</span><span class="o">.</span><span class="n">gear_elements</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">assembly</span><span class="o">.</span><span class="n">gear_elements</span><span class="p">:</span>
            <span class="n">C</span><span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">node</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">node</span><span class="p">]</span> <span class="o">+=</span> <span class="n">element</span><span class="o">.</span><span class="n">C</span><span class="p">()</span>

        <span class="c1"># Build transformation matrix</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">assembly</span><span class="o">.</span><span class="n">E</span><span class="p">()</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">assembly</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
        <span class="c1"># Calculate transformed mass matrix</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">transform</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">C</span><span class="p">),</span> <span class="n">transform</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">C</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calculate_response</span><span class="p">(</span><span class="n">crankshaft</span><span class="p">,</span> <span class="n">rpm</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Calculates the crankshaft&#39;s response to excitation at given rpm.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    crankshaft: openTorsion Assembly class instance</span>
<span class="sd">        Opentorsion Assembly of the crankshaft</span>
<span class="sd">    rpm: float</span>
<span class="sd">        Current rotation speed in rpm</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    sum_response: ndarray</span>
<span class="sd">        Array containing maximum vibratory torque at current rotation speed for each shaft</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">dof</span> <span class="o">=</span> <span class="mi">9</span>
    <span class="n">cylinder_torque</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">calculate_cylinder_torque</span><span class="p">(</span><span class="n">rpm</span><span class="p">)</span>
    <span class="n">dft_parameters</span><span class="p">,</span> <span class="n">harmonics</span> <span class="o">=</span> <span class="n">calculate_dft_components</span><span class="p">(</span><span class="n">cylinder_torque</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">dof</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">harmonics</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;complex128&#39;</span><span class="p">)</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">crankshaft</span><span class="o">.</span><span class="n">M</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">crankshaft</span><span class="o">.</span><span class="n">K</span>
    <span class="n">d</span> <span class="o">=</span> <span class="mf">0.035</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">harmonics</span><span class="p">)):</span>
        <span class="c1"># build T vector</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># offset to the first cylinder</span>
        <span class="n">phase_shift</span> <span class="o">=</span> <span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dof</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;complex128&#39;</span><span class="p">)</span>
        <span class="n">T</span><span class="p">[</span><span class="n">offset</span><span class="p">]</span>   <span class="o">=</span> <span class="n">dft_parameters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">T</span><span class="p">[</span><span class="n">offset</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">dft_parameters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">phase_shift</span><span class="o">*</span><span class="n">harmonics</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">T</span><span class="p">[</span><span class="n">offset</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">dft_parameters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">phase_shift</span><span class="o">*</span><span class="n">harmonics</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">T</span><span class="p">[</span><span class="n">offset</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">dft_parameters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="mf">1.0</span><span class="n">j</span><span class="o">*</span><span class="n">phase_shift</span><span class="o">*</span><span class="n">harmonics</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">T</span><span class="p">[</span><span class="n">offset</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">dft_parameters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="n">j</span><span class="o">*</span><span class="n">phase_shift</span><span class="o">*</span><span class="n">harmonics</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">T</span><span class="p">[</span><span class="n">offset</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">dft_parameters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="mf">3.0</span><span class="n">j</span><span class="o">*</span><span class="n">phase_shift</span><span class="o">*</span><span class="n">harmonics</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">harmonics</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">rpm</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">60</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">relative_damping_C</span><span class="p">(</span><span class="n">crankshaft</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
        <span class="n">receptance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="o">-</span><span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">M</span><span class="o">+</span><span class="mf">1.0</span><span class="n">j</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">C</span><span class="o">+</span><span class="n">K</span><span class="p">)</span>
        <span class="n">q</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">receptance</span> <span class="o">@</span> <span class="n">T</span>
    <span class="c1"># Calculate the angle difference between two consecutive disks</span>
    <span class="n">q_difference</span> <span class="o">=</span> <span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">q</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
    <span class="n">shaft_list</span> <span class="o">=</span> <span class="n">crankshaft</span><span class="o">.</span><span class="n">shaft_elements</span>
    <span class="n">shaft_ks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">shaft</span><span class="o">.</span><span class="n">k</span> <span class="k">for</span> <span class="n">shaft</span> <span class="ow">in</span> <span class="n">shaft_list</span><span class="p">])</span>
    <span class="c1"># Multiply the angle difference between two disks with the connecting shaft stiffness to get</span>
    <span class="c1"># the torque in the shaft</span>
    <span class="n">q_response</span> <span class="o">=</span> <span class="p">(</span><span class="n">shaft_ks</span><span class="o">*</span><span class="n">q_difference</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dof</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">shaft_i</span> <span class="o">=</span> <span class="n">q_response</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">sum_wave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shaft_i</span><span class="p">)):</span>
            <span class="n">this_wave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">shaft_i</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">1.0</span><span class="n">j</span><span class="o">*</span><span class="n">harmonics</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">alpha</span><span class="p">))</span>
            <span class="n">sum_wave</span> <span class="o">+=</span> <span class="n">this_wave</span>
    <span class="n">sum_response</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">q_response</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">sum_response</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_results</span><span class="p">(</span><span class="n">rpms</span><span class="p">,</span> <span class="n">vibratory_torque</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Plots the vibratory torque in wanted shafts for each considered engine speed.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rpms: ndarray</span>
<span class="sd">        All considered engine speeds in rpm</span>
<span class="sd">    vibratory_torque: ndarray</span>
<span class="sd">        Matrix containing maximum vibratory torque at each rotation speed for each shaft.</span>
<span class="sd">        Each row correspond to an engine speed and each column to a shaft.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    shaft_8: ndarray</span>
<span class="sd">        Array containing maximum vibratory torque at all considered engine speeds for shaft</span>
<span class="sd">        between flywheel and 6th cylinder</span>
<span class="sd">    shaft_1: ndarray</span>
<span class="sd">        Array containing maximum vibratory torque at all considered engine speeds for shaft</span>
<span class="sd">        between crankshaft pulley and gear train</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">shaft_8</span> <span class="o">=</span> <span class="p">[</span><span class="n">shaft</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="k">for</span> <span class="n">shaft</span> <span class="ow">in</span> <span class="n">vibratory_torque</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rpms</span><span class="p">,</span> <span class="n">shaft_8</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;calculated&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Engine speed (rpm)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Vibratory torque (Nm)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Torque between the flywheel and the 6th cylinder (Fig.31)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">shaft_1</span> <span class="o">=</span> <span class="p">[</span><span class="n">shaft</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">shaft</span> <span class="ow">in</span> <span class="n">vibratory_torque</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rpms</span><span class="p">,</span> <span class="n">shaft_1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;calculated&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Engine speed (rpm)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Vibratory torque (Nm)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Torque between the crankshaft pulley and the gear train (Fig.32)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">shaft_8</span><span class="p">,</span> <span class="n">shaft_1</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">assembly</span> <span class="o">=</span> <span class="n">crankshaft_assembly</span><span class="p">()</span>
<span class="n">rpms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">2575</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="c1"># Vibratory torque for every shaft and every considered engine speed</span>
<span class="n">vibratory_torque</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">rpm</span> <span class="ow">in</span> <span class="n">rpms</span><span class="p">:</span>
    <span class="n">vibratory_torque</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">calculate_response</span><span class="p">(</span><span class="n">assembly</span><span class="p">,</span> <span class="n">rpm</span><span class="p">))</span>

<span class="n">shaft_8</span><span class="p">,</span> <span class="n">shaft_1</span> <span class="o">=</span> <span class="n">plot_results</span><span class="p">(</span><span class="n">rpms</span><span class="p">,</span> <span class="n">vibratory_torque</span><span class="p">)</span>
<span class="c1"># Same plots but using openTorsions Plots class</span>
<span class="n">plots</span> <span class="o">=</span> <span class="n">opentorsion</span><span class="o">.</span><span class="n">Plots</span><span class="p">(</span><span class="n">assembly</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">torque_response_plot</span><span class="p">(</span><span class="n">rpms</span><span class="p">,</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">shaft_8</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">shaft_1</span><span class="p">)],</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_ICE_example_11_0.png" src="../_images/notebooks_ICE_example_11_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_ICE_example_11_1.png" src="../_images/notebooks_ICE_example_11_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_ICE_example_11_2.png" src="../_images/notebooks_ICE_example_11_2.png" />
</div>
</div>
<p>[1] Mendes AS, Meirelles PS, Zampieri DE. Analysis of torsional vibration in internal combustion engines: Modelling and experimental validation. Proceedings of the Institution of Mechanical Engineers, Part K: Journal of Multi-body Dynamics. 2008;222(2):155-178. doi:10.1243/14644193JMBD126</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="modal_analysis_and_forced_response.html" class="btn btn-neutral float-left" title="Modal analysis and steady-state forced response calculation example" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Aalto-Arotor.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>